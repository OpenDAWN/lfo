"use strict";

var _classCallCheck = require("babel-runtime/helpers/class-call-check")["default"];

var _inherits = require("babel-runtime/helpers/inherits")["default"];

var _get = require("babel-runtime/helpers/get")["default"];

var _createClass = require("babel-runtime/helpers/create-class")["default"];

var _core = require("babel-runtime/core-js")["default"];

/**
 * @fileoverview WAVE LFO module: biquad filter.
 * @author Jean-Philippe.Lambert@ircam.fr, Norbert.Schnell@ircam.fr, victor.saiz@ircam.fr
 * @version 0.1.0
 *
 * @brief  Biquad filter and coefficients calculator
 *
 * Based on the "Cookbook formulae for audio EQ biquad filter
 * coefficients" by Robert Bristow-Johnson
 *
 */

/* y(n) = b0 x(n) + b1 x(n-1) + b2 x(n-2)  */
/*                - a1 x(n-1) - a2 x(n-2)  */

/* f0 is normalised by the nyquist frequency */
/* q must be > 0. */
/* gain must be > 0. and is linear */

/* when there is no gain parameter, one can simply multiply the b
 * coefficients by a (linear) gain */

/* a0 is always 1. as each coefficient is normalised by a0, including a0 */

/* a1 is a[0] and a2 is a[1] */

var _require = require("../core/lfo-base");

var Lfo = _require.Lfo;

var sin = Math.sin;
var cos = Math.cos;
var M_PI = Math.PI;
var sqrt = Math.sqrt;

// coefs calculations
// ------------------

/* LPF: H(s) = 1 / (s^2 + s/Q + 1) */
function lowpass_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = (1 - c) * 0.5 * a0_inv;
  coefs.b1 = (1 - c) * a0_inv;
  coefs.b2 = coefs.b0;
}

/* HPF: H(s) = s^2 / (s^2 + s/Q + 1) */
function highpass_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = (1 + c) * 0.5 * a0_inv;
  coefs.b1 = (-1 - c) * a0_inv;
  coefs.b2 = coefs.b0;
}

/* BPF: H(s) = s / (s^2 + s/Q + 1)  (constant skirt gain, peak gain = Q) */
function bandpass_constant_skirt_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var s = sin(w0);
  var alpha = s / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = s * 0.5 * a0_inv;
  coefs.b1 = 0;
  coefs.b2 = -coefs.b0;
}

/* BPF: H(s) = (s/Q) / (s^2 + s/Q + 1)      (constant 0 dB peak gain) */
function bandpass_constant_peak_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = alpha * a0_inv;
  coefs.b1 = 0;
  coefs.b2 = -coefs.b0;
}

/* notch: H(s) = (s^2 + 1) / (s^2 + s/Q + 1) */
function notch_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = a0_inv;
  coefs.b1 = coefs.a1;
  coefs.b2 = coefs.b0;
}

/* APF: H(s) = (s^2 - s/Q + 1) / (s^2 + s/Q + 1) */
function allpass_coefs(f0, q, coefs) {

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha) * a0_inv;

  coefs.b0 = coefs.a2;
  coefs.b1 = coefs.a1;
  coefs.b2 = 1;
}

/* peakingEQ: H(s) = (s^2 + s*(A/Q) + 1) / (s^2 + s/(A*Q) + 1) */
/* A = sqrt( 10^(dBgain/20) ) = 10^(dBgain/40) */
/* gain is linear here */
function peaking_coefs(f0, q, gain, coefs) {

  var g = sqrt(gain);
  var g_inv = 1 / g;

  var w0 = M_PI * f0;
  var alpha = sin(w0) / (2 * q);
  var c = cos(w0);

  var a0_inv = 1 / (1 + alpha * g_inv);

  coefs.a1 = -2 * c * a0_inv;
  coefs.a2 = (1 - alpha * g_inv) * a0_inv;

  coefs.b0 = (1 + alpha * g) * a0_inv;
  coefs.b1 = coefs.a1;
  coefs.b2 = (1 - alpha * g) * a0_inv;
}

/* lowShelf: H(s) = A * (s^2 + (sqrt(A)/Q)*s + A)/(A*s^2 + (sqrt(A)/Q)*s + 1) */
/* A = sqrt( 10^(dBgain/20) ) = 10^(dBgain/40) */
/* gain is linear here */
function lowshelf_coefs(f0, q, gain, coefs) {

  var g = sqrt(gain);

  var w0 = M_PI * f0;
  var alpha_2_sqrtg = sin(w0) * sqrt(g) / q;
  var c = cos(w0);

  var a0_inv = 1 / (g + 1 + (g - 1) * c + alpha_2_sqrtg);

  coefs.a1 = -2 * (g - 1 + (g + 1) * c) * a0_inv;
  coefs.a2 = (g + 1 + (g - 1) * c - alpha_2_sqrtg) * a0_inv;

  coefs.b0 = g * (g + 1 - (g - 1) * c + alpha_2_sqrtg) * a0_inv;
  coefs.b1 = 2 * g * (g - 1 - (g + 1) * c) * a0_inv;
  coefs.b2 = g * (g + 1 - (g - 1) * c - alpha_2_sqrtg) * a0_inv;
}

/* highShelf: H(s) = A * (A*s^2 + (sqrt(A)/Q)*s + 1)/(s^2 + (sqrt(A)/Q)*s + A) */
/* A = sqrt( 10^(dBgain/20) ) = 10^(dBgain/40) */
/* gain is linear here */
function highshelf_coefs(f0, q, gain, coefs) {

  var g = sqrt(gain);

  var w0 = M_PI * f0;
  var alpha_2_sqrtg = sin(w0) * sqrt(g) / q;
  var c = cos(w0);

  var a0_inv = 1 / (g + 1 - (g - 1) * c + alpha_2_sqrtg);

  coefs.a1 = 2 * (g - 1 - (g + 1) * c) * a0_inv;
  coefs.a2 = (g + 1 - (g - 1) * c - alpha_2_sqrtg) * a0_inv;

  coefs.b0 = g * (g + 1 + (g - 1) * c + alpha_2_sqrtg) * a0_inv;
  coefs.b1 = -2 * g * (g - 1 + (g + 1) * c) * a0_inv;
  coefs.b2 = g * (g + 1 + (g - 1) * c - alpha_2_sqrtg) * a0_inv;
}

/* helper */
function calculateCoefs(type, f0, q, gain, coefs) {

  switch (type) {
    case "lowpass":
      lowpass_coefs(f0, q, coefs);
      break;

    case "highpass":
      highpass_coefs(f0, q, coefs);
      break;

    case "bandpass_constant_skirt":
      bandpass_constant_skirt_coefs(f0, q, coefs);
      break;

    case "bandpass_constant_peak":
      bandpass_constant_peak_coefs(f0, q, coefs);
      break;

    case "notch":
      notch_coefs(f0, q, coefs);
      break;

    case "allpass":
      allpass_coefs(f0, q, coefs);
      break;

    case "peaking":
      peaking_coefs(f0, q, gain, coefs);
      break;

    case "lowshelf":
      lowshelf_coefs(f0, q, gain, coefs);
      break;

    case "highshelf":
      highshelf_coefs(f0, q, gain, coefs);
      break;
  }

  switch (type) {
    case "lowpass":
    case "highpass":
    case "bandpass_constant_skirt":
    case "bandpass_constant_peak":
    case "notch":
    case "allpass":

      if (gain != 1) {
        coefs.b0 *= gain;
        coefs.b1 *= gain;
        coefs.b2 *= gain;
      }

      break;

    /* gain is already integrated for the following */
    case "peaking":
    case "lowshelf":
    case "highshelf":
      break;
  }
}

/* direct form I */
/* a0 = 1, a1 = a[0], a2 = a[1] */
/* 4 states (in that order): x(n-1), x(n-2), y(n-1), y(n-2)  */
function biquadArrayDf1(coefs, state, inFrame, outFrame, size) {
  for (var i = 0; i < size; i++) {
    var y = coefs.b0 * inFrame[i] + coefs.b1 * state.xn_1[i] + coefs.b2 * state.xn_2[i] - coefs.a1 * state.yn_1[i] - coefs.a2 * state.yn_2[i];

    outFrame[i] = y;

    // update states
    state.xn_2[i] = state.xn_1[i];
    state.xn_1[i] = inFrame[i];

    state.yn_2[i] = state.yn_1[i];
    state.yn_1[i] = y;
  }
}

/* transposed direct form II */
/* a0 = 1, a1 = a[0], a2 = a[1] */
/* 2 states */
function biquadArrayDf2(coefs, state, inFrame, outFrame, size) {
  for (var i = 0; i < size; i++) {
    outFrame[i] = coefs.b0 * inFrame[i] + state.xn_1[i];

    // update states
    state.xn_1[i] = coefs.b1 * inFrame[i] - coefs.a1[i] * outFrame[i] + state.xn_2[i];
    state.xn_2[i] = coefs.b2 * inFrame[i] - coefs.a2[i] * outFrame[i];
  }
}

var Biquad = (function (_Lfo) {
  function Biquad(previous, options) {
    _classCallCheck(this, Biquad);

    var defaults = {
      filterType: "lowpass",
      f0: 1,
      gain: 1,
      q: 1
    };

    _get(_core.Object.getPrototypeOf(Biquad.prototype), "constructor", this).call(this, previous, options, defaults);
    this.type = "biquad";

    // from here on options is this.params

    // to implement
    // if(opts.damp) …
    // if(opts.decay) …
    // if(opts.over) …

    var frameRate = this.streamParams.frameRate;
    // if no frameRate or framerate is 0 we shall halt!
    if (!frameRate || frameRate <= 0) {
      throw new Error("This Operator requires a frameRate higher than 0.");
    }

    var normF0 = this.params.f0 / frameRate,
        gain = this.params.gain,
        q;

    if (this.params.q) {
      q = this.params.q;
    }
    if (this.params.bw) {
      q = this.params.f0 / this.params.bw;
    }

    this.coefs = {
      b0: 0,
      b1: 0,
      b2: 0,
      a1: 0,
      a2: 0
    };

    var frameSize = this.streamParams.frameSize;
    this.state = {
      xn_1: new Float32Array(frameSize),
      xn_2: new Float32Array(frameSize),
      yn_1: new Float32Array(frameSize),
      yn_2: new Float32Array(frameSize)
    };

    calculateCoefs(this.params.filterType, normF0, q, gain, this.coefs);
    this.setupStream();
  }

  _inherits(Biquad, _Lfo);

  _createClass(Biquad, {
    process: {
      value: function process(time, frame) {
        biquadArrayDf1(this.coefs, this.state, frame, this.outFrame, frame.length);
        this.output(time);
      }
    }
  });

  return Biquad;
})(Lfo);

function factory(previous, options) {
  return new Biquad(previous, options);
}
factory.Biquad = Biquad;

module.exports = factory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi9zb3VyY2VzL3Byb2Nlc3Mtd29ya2VyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2VBNEJjLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7SUFBbkMsR0FBRyxZQUFILEdBQUc7O0FBRVQsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztBQUNuQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0FBQ25CLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7QUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQzs7Ozs7O0FBTXJCLFNBQVMsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFOztBQUVqQyxNQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ25CLE1BQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFHLEdBQUcsQ0FBQyxDQUFBLEFBQUMsQ0FBQztBQUNoQyxNQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7O0FBRWhCLE1BQUksTUFBTSxHQUFHLENBQUcsSUFBSSxDQUFHLEdBQUcsS0FBSyxDQUFBLEFBQUMsQ0FBQzs7QUFFakMsT0FBSyxDQUFDLEVBQUUsR0FBRyxBQUFDLENBQUMsQ0FBRyxHQUFHLENBQUMsR0FBSSxNQUFNLENBQUM7QUFDL0IsT0FBSyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUcsR0FBRyxLQUFLLENBQUEsR0FBSSxNQUFNLENBQUM7O0FBRWxDLE9BQUssQ0FBQyxFQUFFLEdBQUcsQUFBQyxDQUFDLENBQUcsR0FBRyxDQUFDLENBQUEsR0FBSSxHQUFHLEdBQUksTUFBTSxDQUFDO0FBQ3RDLE9BQUssQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFHLEdBQUcsQ0FBQyxDQUFBLEdBQUksTUFBTSxDQUFDO0FBQzlC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R0FBRzs7QUEyRHhCLFNBQVMsT0FBTyxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUU7QUFDbEMsU0FBTyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7Q0FDdEM7QUFDRCxPQUFPLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzs7QUFFeEIsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMiLCJmaWxlIjoiZXM2L3NvdXJjZXMvcHJvY2Vzcy13b3JrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFdBVkUgTEZPIG1vZHVsZTogYmlxdWFkIGZpbHRlci5cbiAqIEBhdXRob3IgSmVhbi1QaGlsaXBwZS5MYW1iZXJ0QGlyY2FtLmZyLCBOb3JiZXJ0LlNjaG5lbGxAaXJjYW0uZnIsIHZpY3Rvci5zYWl6QGlyY2FtLmZyXG4gKiBAdmVyc2lvbiAwLjEuMFxuICpcbiAqIEBicmllZiAgQmlxdWFkIGZpbHRlciBhbmQgY29lZmZpY2llbnRzIGNhbGN1bGF0b3JcbiAqXG4gKiBCYXNlZCBvbiB0aGUgXCJDb29rYm9vayBmb3JtdWxhZSBmb3IgYXVkaW8gRVEgYmlxdWFkIGZpbHRlclxuICogY29lZmZpY2llbnRzXCIgYnkgUm9iZXJ0IEJyaXN0b3ctSm9obnNvblxuICpcbiAqL1xuXG4vKiB5KG4pID0gYjAgeChuKSArIGIxIHgobi0xKSArIGIyIHgobi0yKSAgKi9cbi8qICAgICAgICAgICAgICAgIC0gYTEgeChuLTEpIC0gYTIgeChuLTIpICAqL1xuXG4vKiBmMCBpcyBub3JtYWxpc2VkIGJ5IHRoZSBueXF1aXN0IGZyZXF1ZW5jeSAqL1xuLyogcSBtdXN0IGJlID4gMC4gKi9cbi8qIGdhaW4gbXVzdCBiZSA+IDAuIGFuZCBpcyBsaW5lYXIgKi9cblxuLyogd2hlbiB0aGVyZSBpcyBubyBnYWluIHBhcmFtZXRlciwgb25lIGNhbiBzaW1wbHkgbXVsdGlwbHkgdGhlIGJcbiAqIGNvZWZmaWNpZW50cyBieSBhIChsaW5lYXIpIGdhaW4gKi9cblxuLyogYTAgaXMgYWx3YXlzIDEuIGFzIGVhY2ggY29lZmZpY2llbnQgaXMgbm9ybWFsaXNlZCBieSBhMCwgaW5jbHVkaW5nIGEwICovXG5cbi8qIGExIGlzIGFbMF0gYW5kIGEyIGlzIGFbMV0gKi9cblxudmFyIHsgTGZvIH0gPSByZXF1aXJlKCcuLi9jb3JlL2xmby1iYXNlJyk7XG5cbnZhciBzaW4gPSBNYXRoLnNpbjtcbnZhciBjb3MgPSBNYXRoLmNvcztcbnZhciBNX1BJID0gTWF0aC5QSTtcbnZhciBzcXJ0ID0gTWF0aC5zcXJ0O1xuXG4gIC8vIGNvZWZzIGNhbGN1bGF0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKiBMUEY6IEgocykgPSAxIC8gKHNeMiArIHMvUSArIDEpICovXG5mdW5jdGlvbiBsb3dwYXNzX2NvZWZzKGYwLCBxLCBjb2Vmcykge1xuXG4gICAgdmFyIHcwID0gTV9QSSAqIGYwO1xuICAgIHZhciBhbHBoYSA9IHNpbih3MCkgLyAoMi4wICogcSk7XG4gICAgdmFyIGMgPSBjb3ModzApO1xuXG4gICAgdmFyIGEwX2ludiA9IDEuMCAvICgxLjAgKyBhbHBoYSk7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoMS4wIC0gYWxwaGEpICogYTBfaW52O1xuXG4gICAgY29lZnMuYjAgPSAoKDEuMCAtIGMpICogMC41KSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMSA9ICgxLjAgLSBjKSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMiA9IGNvZWZzLmIwO1xuXG4gIH1cblxuICAvKiBIUEY6IEgocykgPSBzXjIgLyAoc14yICsgcy9RICsgMSkgKi9cbmZ1bmN0aW9uIGhpZ2hwYXNzX2NvZWZzKGYwLCBxLCBjb2Vmcykge1xuXG4gICAgdmFyIHcwID0gTV9QSSAqIGYwO1xuICAgIHZhciBhbHBoYSA9IHNpbih3MCkgLyAoMi4wICogcSk7XG4gICAgdmFyIGMgPSBjb3ModzApO1xuXG4gICAgdmFyIGEwX2ludiA9IDEuMCAvICgxLjAgKyBhbHBoYSk7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoMS4wIC0gYWxwaGEpICogYTBfaW52O1xuXG4gICAgY29lZnMuYjAgPSAoKDEuMCArIGMpICogMC41KSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMSA9ICgtMS4wIC0gYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYjIgPSBjb2Vmcy5iMDtcblxuICB9XG5cbiAgLyogQlBGOiBIKHMpID0gcyAvIChzXjIgKyBzL1EgKyAxKSAgKGNvbnN0YW50IHNraXJ0IGdhaW4sIHBlYWsgZ2FpbiA9IFEpICovXG5mdW5jdGlvbiBiYW5kcGFzc19jb25zdGFudF9za2lydF9jb2VmcyhmMCwgcSwgY29lZnMpIHtcblxuICAgIHZhciB3MCA9IE1fUEkgKiBmMDtcbiAgICB2YXIgcyA9IHNpbih3MCk7XG4gICAgdmFyIGFscGhhID0gcyAvICgyLjAgKiBxKTtcbiAgICB2YXIgYyA9IGNvcyh3MCk7XG5cbiAgICB2YXIgYTBfaW52ID0gMS4wIC8gKDEuMCArIGFscGhhKTtcblxuICAgIGNvZWZzLmExID0gKC0yLjAgKiBjKSAqIGEwX2ludjtcbiAgICBjb2Vmcy5hMiA9ICgxLjAgLSBhbHBoYSkgKiBhMF9pbnY7XG5cbiAgICBjb2Vmcy5iMCA9IChzICogMC41KSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMSA9IDAuMDtcbiAgICBjb2Vmcy5iMiA9IC1jb2Vmcy5iMDtcblxuICB9XG5cbiAgLyogQlBGOiBIKHMpID0gKHMvUSkgLyAoc14yICsgcy9RICsgMSkgICAgICAoY29uc3RhbnQgMCBkQiBwZWFrIGdhaW4pICovXG5mdW5jdGlvbiBiYW5kcGFzc19jb25zdGFudF9wZWFrX2NvZWZzKGYwLCBxLCBjb2Vmcykge1xuXG4gICAgdmFyIHcwID0gTV9QSSAqIGYwO1xuICAgIHZhciBhbHBoYSA9IHNpbih3MCkgLyAoMi4wICogcSk7XG4gICAgdmFyIGMgPSBjb3ModzApO1xuXG4gICAgdmFyIGEwX2ludiA9IDEuMCAvICgxLjAgKyBhbHBoYSk7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoMS4wIC0gYWxwaGEpICogYTBfaW52O1xuXG4gICAgY29lZnMuYjAgPSBhbHBoYSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMSA9IDAuMDtcbiAgICBjb2Vmcy5iMiA9IC1jb2Vmcy5iMDtcbiAgfVxuXG4gIC8qIG5vdGNoOiBIKHMpID0gKHNeMiArIDEpIC8gKHNeMiArIHMvUSArIDEpICovXG5mdW5jdGlvbiBub3RjaF9jb2VmcyhmMCwgcSwgY29lZnMpIHtcblxuICAgIHZhciB3MCA9IE1fUEkgKiBmMDtcbiAgICB2YXIgYWxwaGEgPSBzaW4odzApIC8gKDIuMCAqIHEpO1xuICAgIHZhciBjID0gY29zKHcwKTtcblxuICAgIHZhciBhMF9pbnYgPSAxLjAgLyAoMS4wICsgYWxwaGEpO1xuXG4gICAgY29lZnMuYTEgPSAoLTIuMCAqIGMpICogYTBfaW52O1xuICAgIGNvZWZzLmEyID0gKDEuMCAtIGFscGhhKSAqIGEwX2ludjtcblxuICAgIGNvZWZzLmIwID0gYTBfaW52O1xuICAgIGNvZWZzLmIxID0gY29lZnMuYTE7XG4gICAgY29lZnMuYjIgPSBjb2Vmcy5iMDtcblxuICB9XG5cbiAgLyogQVBGOiBIKHMpID0gKHNeMiAtIHMvUSArIDEpIC8gKHNeMiArIHMvUSArIDEpICovXG5mdW5jdGlvbiBhbGxwYXNzX2NvZWZzKGYwLCBxLCBjb2Vmcykge1xuXG4gICAgdmFyIHcwID0gTV9QSSAqIGYwO1xuICAgIHZhciBhbHBoYSA9IHNpbih3MCkgLyAoMi4wICogcSk7XG4gICAgdmFyIGMgPSBjb3ModzApO1xuXG4gICAgdmFyIGEwX2ludiA9IDEuMCAvICgxLjAgKyBhbHBoYSk7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoMS4wIC0gYWxwaGEpICogYTBfaW52O1xuXG4gICAgY29lZnMuYjAgPSBjb2Vmcy5hMjtcbiAgICBjb2Vmcy5iMSA9IGNvZWZzLmExO1xuICAgIGNvZWZzLmIyID0gMS4wO1xuXG4gIH1cblxuICAvKiBwZWFraW5nRVE6IEgocykgPSAoc14yICsgcyooQS9RKSArIDEpIC8gKHNeMiArIHMvKEEqUSkgKyAxKSAqL1xuICAvKiBBID0gc3FydCggMTBeKGRCZ2Fpbi8yMCkgKSA9IDEwXihkQmdhaW4vNDApICovXG4gIC8qIGdhaW4gaXMgbGluZWFyIGhlcmUgKi9cbmZ1bmN0aW9uIHBlYWtpbmdfY29lZnMoZjAsIHEsIGdhaW4sIGNvZWZzKSB7XG5cbiAgICB2YXIgZyA9IHNxcnQoZ2Fpbik7XG4gICAgdmFyIGdfaW52ID0gMS4wIC8gZztcblxuICAgIHZhciB3MCA9IE1fUEkgKiBmMDtcbiAgICB2YXIgYWxwaGEgPSBzaW4odzApIC8gKDIuMCAqIHEpO1xuICAgIHZhciBjID0gY29zKHcwKTtcblxuICAgIHZhciBhMF9pbnYgPSAxLjAgLyAoMS4wICsgYWxwaGEgKiBnX2ludik7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogYykgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoMS4wIC0gYWxwaGEgKiBnX2ludikgKiBhMF9pbnY7XG5cbiAgICBjb2Vmcy5iMCA9ICgxLjAgKyBhbHBoYSAqIGcpICogYTBfaW52O1xuICAgIGNvZWZzLmIxID0gY29lZnMuYTE7XG4gICAgY29lZnMuYjIgPSAoMS4wIC0gYWxwaGEgKiBnKSAqIGEwX2ludjtcblxuICB9XG5cbiAgLyogbG93U2hlbGY6IEgocykgPSBBICogKHNeMiArIChzcXJ0KEEpL1EpKnMgKyBBKS8oQSpzXjIgKyAoc3FydChBKS9RKSpzICsgMSkgKi9cbiAgLyogQSA9IHNxcnQoIDEwXihkQmdhaW4vMjApICkgPSAxMF4oZEJnYWluLzQwKSAqL1xuICAvKiBnYWluIGlzIGxpbmVhciBoZXJlICovXG5mdW5jdGlvbiBsb3dzaGVsZl9jb2VmcyhmMCwgcSwgZ2FpbiwgY29lZnMpIHtcblxuICAgIHZhciBnID0gc3FydChnYWluKTtcblxuICAgIHZhciB3MCA9IE1fUEkgKiBmMDtcbiAgICB2YXIgYWxwaGFfMl9zcXJ0ZyA9IHNpbih3MCkgKiBzcXJ0KGcpIC8gcSA7XG4gICAgdmFyIGMgPSBjb3ModzApO1xuXG4gICAgdmFyIGEwX2ludiA9IDEuMCAvICggKGcrMS4wKSArIChnLTEuMCkgKiBjICsgYWxwaGFfMl9zcXJ0Zyk7XG5cbiAgICBjb2Vmcy5hMSA9ICgtMi4wICogICAgICggKGctMS4wKSArIChnKzEuMCkgKiBjICAgICAgICAgICAgICAgICkgKSAqIGEwX2ludjtcbiAgICBjb2Vmcy5hMiA9ICggICAgICAgICAgICAgKGcrMS4wKSArIChnLTEuMCkgKiBjIC0gYWxwaGFfMl9zcXJ0ZyAgKSAqIGEwX2ludjtcblxuICAgIGNvZWZzLmIwID0gKCAgICAgICBnICogKCAoZysxLjApIC0gKGctMS4wKSAqIGMgKyBhbHBoYV8yX3NxcnRnKSApICogYTBfaW52O1xuICAgIGNvZWZzLmIxID0gKCAyLjAgKiBnICogKCAoZy0xLjApIC0gKGcrMS4wKSAqIGMgICAgICAgICAgICAgICAgKSApICogYTBfaW52O1xuICAgIGNvZWZzLmIyID0gKCAgICAgICBnICogKCAoZysxLjApIC0gKGctMS4wKSAqIGMgLSBhbHBoYV8yX3NxcnRnKSApICogYTBfaW52O1xuXG4gIH1cblxuICAvKiBoaWdoU2hlbGY6IEgocykgPSBBICogKEEqc14yICsgKHNxcnQoQSkvUSkqcyArIDEpLyhzXjIgKyAoc3FydChBKS9RKSpzICsgQSkgKi9cbiAgLyogQSA9IHNxcnQoIDEwXihkQmdhaW4vMjApICkgPSAxMF4oZEJnYWluLzQwKSAqL1xuICAvKiBnYWluIGlzIGxpbmVhciBoZXJlICovXG5mdW5jdGlvbiBoaWdoc2hlbGZfY29lZnMoZjAsIHEsIGdhaW4sIGNvZWZzKSB7XG5cbiAgICB2YXIgZyA9IHNxcnQoZ2Fpbik7XG5cbiAgICB2YXIgdzAgPSBNX1BJICogZjA7XG4gICAgdmFyIGFscGhhXzJfc3FydGcgPSBzaW4odzApICogc3FydChnKSAvIHEgO1xuICAgIHZhciBjID0gY29zKHcwKTtcblxuICAgIHZhciBhMF9pbnYgPSAxLjAgLyAoIChnKzEuMCkgLSAoZy0xLjApICogYyArIGFscGhhXzJfc3FydGcpO1xuXG4gICAgY29lZnMuYTEgPSAoIDIuMCAqICAgICAoIChnLTEuMCkgLSAoZysxLjApICogYyAgICAgICAgICAgICAgICApICkgKiBhMF9pbnY7XG4gICAgY29lZnMuYTIgPSAoICAgICAgICAgICAgIChnKzEuMCkgLSAoZy0xLjApICogYyAtIGFscGhhXzJfc3FydGcgICkgKiBhMF9pbnY7XG5cbiAgICBjb2Vmcy5iMCA9ICggICAgICBnICogKCAgKGcrMS4wKSArIChnLTEuMCkgKiBjICsgYWxwaGFfMl9zcXJ0ZykgKSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMSA9ICgtMi4wICogZyAqICggKGctMS4wKSArIChnKzEuMCkgKiBjICAgICAgICAgICAgICAgICkgKSAqIGEwX2ludjtcbiAgICBjb2Vmcy5iMiA9ICggICAgICBnICogKCAgKGcrMS4wKSArIChnLTEuMCkgKiBjIC0gYWxwaGFfMl9zcXJ0ZykgKSAqIGEwX2ludjtcblxuICB9XG5cbiAgLyogaGVscGVyICovXG5mdW5jdGlvbiBjYWxjdWxhdGVDb2Vmcyh0eXBlLCBmMCwgcSwgZ2FpbiwgY29lZnMpIHtcblxuICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICBjYXNlICdsb3dwYXNzJzpcbiAgICAgICAgbG93cGFzc19jb2VmcyhmMCwgcSwgY29lZnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnaGlnaHBhc3MnOlxuICAgICAgICBoaWdocGFzc19jb2VmcyhmMCwgcSwgY29lZnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnYmFuZHBhc3NfY29uc3RhbnRfc2tpcnQnOlxuICAgICAgICBiYW5kcGFzc19jb25zdGFudF9za2lydF9jb2VmcyhmMCwgcSwgY29lZnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnYmFuZHBhc3NfY29uc3RhbnRfcGVhayc6XG4gICAgICAgIGJhbmRwYXNzX2NvbnN0YW50X3BlYWtfY29lZnMoZjAsIHEsIGNvZWZzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ25vdGNoJzpcbiAgICAgICAgbm90Y2hfY29lZnMoZjAsIHEsIGNvZWZzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2FsbHBhc3MnOlxuICAgICAgICBhbGxwYXNzX2NvZWZzKGYwLCBxLCBjb2Vmcyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdwZWFraW5nJzpcbiAgICAgICAgcGVha2luZ19jb2VmcyhmMCwgcSwgZ2FpbiwgY29lZnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbG93c2hlbGYnOlxuICAgICAgICBsb3dzaGVsZl9jb2VmcyhmMCwgcSwgZ2FpbiwgY29lZnMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnaGlnaHNoZWxmJzpcbiAgICAgICAgaGlnaHNoZWxmX2NvZWZzKGYwLCBxLCBnYWluLCBjb2Vmcyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnbG93cGFzcyc6XG4gICAgICBjYXNlICdoaWdocGFzcyc6XG4gICAgICBjYXNlICdiYW5kcGFzc19jb25zdGFudF9za2lydCc6XG4gICAgICBjYXNlICdiYW5kcGFzc19jb25zdGFudF9wZWFrJzpcbiAgICAgIGNhc2UgJ25vdGNoJzpcbiAgICAgIGNhc2UgJ2FsbHBhc3MnOlxuXG4gICAgICAgaWYgKGdhaW4gIT0gMS4wKSB7XG4gICAgICAgICBjb2Vmcy5iMCAqPSBnYWluO1xuICAgICAgICAgY29lZnMuYjEgKj0gZ2FpbjtcbiAgICAgICAgIGNvZWZzLmIyICo9IGdhaW47XG4gICAgICAgfVxuXG4gICAgICAgYnJlYWs7XG5cbiAgICAgIC8qIGdhaW4gaXMgYWxyZWFkeSBpbnRlZ3JhdGVkIGZvciB0aGUgZm9sbG93aW5nICovXG4gICAgICBjYXNlICdwZWFraW5nJzpcbiAgICAgIGNhc2UgJ2xvd3NoZWxmJzpcbiAgICAgIGNhc2UgJ2hpZ2hzaGVsZic6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICB9XG5cbi8qIGRpcmVjdCBmb3JtIEkgKi9cbi8qIGEwID0gMSwgYTEgPSBhWzBdLCBhMiA9IGFbMV0gKi9cbi8qIDQgc3RhdGVzIChpbiB0aGF0IG9yZGVyKTogeChuLTEpLCB4KG4tMiksIHkobi0xKSwgeShuLTIpICAqL1xuZnVuY3Rpb24gYmlxdWFkQXJyYXlEZjEoY29lZnMsIHN0YXRlLCBpbkZyYW1lLCBvdXRGcmFtZSwgc2l6ZSkge1xuICBmb3IobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgdmFyIHkgPSBjb2Vmcy5iMCAqIGluRnJhbWVbaV0gKyBjb2Vmcy5iMSAqIHN0YXRlLnhuXzFbaV0gKyBjb2Vmcy5iMiAqIHN0YXRlLnhuXzJbaV0gLSBjb2Vmcy5hMSAqIHN0YXRlLnluXzFbaV0gLSBjb2Vmcy5hMiAqIHN0YXRlLnluXzJbaV07XG5cbiAgICBvdXRGcmFtZVtpXSA9IHk7XG5cbiAgICAvLyB1cGRhdGUgc3RhdGVzXG4gICAgc3RhdGUueG5fMltpXSA9IHN0YXRlLnhuXzFbaV07XG4gICAgc3RhdGUueG5fMVtpXSA9IGluRnJhbWVbaV07XG5cbiAgICBzdGF0ZS55bl8yW2ldID0gc3RhdGUueW5fMVtpXTtcbiAgICBzdGF0ZS55bl8xW2ldID0geTtcbiAgfVxufVxuXG4vKiB0cmFuc3Bvc2VkIGRpcmVjdCBmb3JtIElJICovXG4vKiBhMCA9IDEsIGExID0gYVswXSwgYTIgPSBhWzFdICovXG4vKiAyIHN0YXRlcyAqL1xuZnVuY3Rpb24gYmlxdWFkQXJyYXlEZjIoY29lZnMsIHN0YXRlLCBpbkZyYW1lLCBvdXRGcmFtZSwgc2l6ZSkge1xuICBmb3IobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgb3V0RnJhbWVbaV0gPSBjb2Vmcy5iMCAqIGluRnJhbWVbaV0gKyBzdGF0ZS54bl8xW2ldO1xuXG4gICAgLy8gdXBkYXRlIHN0YXRlc1xuICAgIHN0YXRlLnhuXzFbaV0gPSBjb2Vmcy5iMSAqIGluRnJhbWVbaV0gLSBjb2Vmcy5hMVtpXSAqIG91dEZyYW1lW2ldICsgc3RhdGUueG5fMltpXTtcbiAgICBzdGF0ZS54bl8yW2ldID0gY29lZnMuYjIgKiBpbkZyYW1lW2ldIC0gY29lZnMuYTJbaV0gKiBvdXRGcmFtZVtpXTtcbiAgfVxufVxuXG5jbGFzcyBCaXF1YWQgZXh0ZW5kcyBMZm8ge1xuXG4gIGNvbnN0cnVjdG9yKHByZXZpb3VzLCBvcHRpb25zKSB7XG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgZmlsdGVyVHlwZTonbG93cGFzcycsXG4gICAgICBmMDogMS4wLFxuICAgICAgZ2FpbjogMS4wLFxuICAgICAgcTogMS4wXG4gICAgfTtcblxuICAgIHN1cGVyKHByZXZpb3VzLCBvcHRpb25zLCBkZWZhdWx0cyk7XG4gICAgdGhpcy50eXBlID0gJ2JpcXVhZCc7XG5cbiAgICAvLyBmcm9tIGhlcmUgb24gb3B0aW9ucyBpcyB0aGlzLnBhcmFtc1xuXG4gICAgLy8gdG8gaW1wbGVtZW50XG4gICAgLy8gaWYob3B0cy5kYW1wKSDigKZcbiAgICAvLyBpZihvcHRzLmRlY2F5KSDigKZcbiAgICAvLyBpZihvcHRzLm92ZXIpIOKAplxuXG4gICAgdmFyIGZyYW1lUmF0ZSA9IHRoaXMuc3RyZWFtUGFyYW1zLmZyYW1lUmF0ZTtcbiAgICAvLyBpZiBubyBmcmFtZVJhdGUgb3IgZnJhbWVyYXRlIGlzIDAgd2Ugc2hhbGwgaGFsdCFcbiAgICBpZiAoIWZyYW1lUmF0ZSB8fCBmcmFtZVJhdGUgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIE9wZXJhdG9yIHJlcXVpcmVzIGEgZnJhbWVSYXRlIGhpZ2hlciB0aGFuIDAuJyk7XG4gICAgfVxuXG4gICAgdmFyIG5vcm1GMCA9IHRoaXMucGFyYW1zLmYwIC8gZnJhbWVSYXRlLFxuICAgICAgICBnYWluID0gdGhpcy5wYXJhbXMuZ2FpbixcbiAgICAgICAgcTtcblxuICAgIGlmICh0aGlzLnBhcmFtcy5xKSAgeyBxID0gdGhpcy5wYXJhbXMucTsgfVxuICAgIGlmICh0aGlzLnBhcmFtcy5idykgeyBxID0gdGhpcy5wYXJhbXMuZjAgLyB0aGlzLnBhcmFtcy5idzsgfVxuXG4gICAgdGhpcy5jb2VmcyA9IHtcbiAgICAgIGIwOiAwLFxuICAgICAgYjE6IDAsXG4gICAgICBiMjogMCxcbiAgICAgIGExOiAwLFxuICAgICAgYTI6IDBcbiAgICB9O1xuXG4gICAgdmFyIGZyYW1lU2l6ZSA9IHRoaXMuc3RyZWFtUGFyYW1zLmZyYW1lU2l6ZTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgeG5fMTogbmV3IEZsb2F0MzJBcnJheShmcmFtZVNpemUpLFxuICAgICAgeG5fMjogbmV3IEZsb2F0MzJBcnJheShmcmFtZVNpemUpLFxuICAgICAgeW5fMTogbmV3IEZsb2F0MzJBcnJheShmcmFtZVNpemUpLFxuICAgICAgeW5fMjogbmV3IEZsb2F0MzJBcnJheShmcmFtZVNpemUpXG4gICAgfTtcblxuICAgIGNhbGN1bGF0ZUNvZWZzKHRoaXMucGFyYW1zLmZpbHRlclR5cGUsIG5vcm1GMCwgcSwgZ2FpbiwgdGhpcy5jb2Vmcyk7XG4gICAgdGhpcy5zZXR1cFN0cmVhbSgpO1xuICB9XG5cbiAgcHJvY2Vzcyh0aW1lLCBmcmFtZSkge1xuICAgIGJpcXVhZEFycmF5RGYxKHRoaXMuY29lZnMsIHRoaXMuc3RhdGUsIGZyYW1lLCB0aGlzLm91dEZyYW1lLCBmcmFtZS5sZW5ndGgpO1xuICAgIHRoaXMub3V0cHV0KHRpbWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGZhY3RvcnkocHJldmlvdXMsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIG5ldyBCaXF1YWQocHJldmlvdXMsIG9wdGlvbnMpO1xufVxuZmFjdG9yeS5CaXF1YWQgPSBCaXF1YWQ7XG5cbm1vZHVsZS5leHBvcnRzID0gZmFjdG9yeTtcblxuIl19